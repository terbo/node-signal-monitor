[{"id":"80d8978d.fe3298","type":"function","z":"ded44214.62396","name":"Draw Marker(s)","func":"const cfg = flow.get('config')\nconst pkt = msg.payload\n\nvar macs = flow.get('macs')\n\nvar mac = pkt.mac\nvar name;\n\nif(macs.hasOwnProperty(pkt.mac)) {\n    if((macs[mac].location == msg.payload.location) &&\n        macs[mac].rssi == pkt.rssi) {\n        return\n    } else {\n        macs[mac].rssi = pkt.rssi\n        macs[mac].location.lon = pkt.location.lon\n        macs[mac].location.lat = pkt.location.lat\n        macs[mac].lastseen = pkt.time\n    }\n} else {\n    macs[mac] = { vendor: pkt.vendor,\n                  lat: pkt.location.lat,\n                  lon: pkt.location.lon,\n                  firstseen: new Date(),\n                  lastseen: new Date(),\n                  type: pkt.type,\n                  rssi: pkt.rssi.last,\n                }\n}\n\nflow.set('macs',macs)\n\nconst intensity = (parseInt(pkt.rssi) + 100) * 0.01\nconst layer = (pkt.type == 'ap') ? 'Access Points' : 'Clients'\n\nmsg.payload = {'name': `${pkt.macSm} - ${pkt.vendorSm}`,\n               'lat': macs[mac].lat, 'lon': macs[mac].lon,\n               'ttl': cfg.ap_ttl,\n               'icon': 'fa-wifi',\n               'rssi': macs[mac].rssi,\n               'vendor': macs[mac].vendor,\n               'layer': layer,\n               'intensity': intensity\n}\n\nreturn msg","outputs":1,"noerr":0,"x":650,"y":360,"wires":[["b855f3b5.8f5fa"]]}]
